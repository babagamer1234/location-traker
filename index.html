<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-User Live Tracker</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  html, body { height: 100%; margin: 0; padding: 0; }
  #map { height: 100%; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyA5iHHWvOKZnKlZCZz57O8ALtSkfNdMmrE",
    authDomain: "live-tracker-554a7.firebaseapp.com",
    databaseURL: "https://live-tracker-554a7-default-rtdb.firebaseio.com",
    projectId: "live-tracker-554a7",
    storageBucket: "live-tracker-554a7.firebasestorage.app",
    messagingSenderId: "951695061306",
    appId: "1:951695061306:web:a7b9478538f86f50a36003",
    measurementId: "G-V4LCZSEQLC"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Leaflet map
  const map = L.map('map').setView([29.35, 76.49], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Object to hold markers for each user
  const markers = {};

  // Listen to all users
  db.ref("users").on("value", snapshot => {
    const users = snapshot.val();
    if(users){
      for(const uid in users){
        const user = users[uid];
        const lat = user.latitude;
        const lng = user.longitude;
        const name = user.name || uid;

        if(markers[uid]){
          // update existing marker
          markers[uid].setLatLng([lat, lng]);
        } else {
          // create new marker
          markers[uid] = L.marker([lat, lng]).addTo(map).bindPopup(name);
        }
      }
    }
  });
</script>
</body>
</html>
